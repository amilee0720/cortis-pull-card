<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Your Daily CORTIS!</title>
    <style>
        :root {
            --bg: #ffffff;
            --grey: #333333;
            --mid-grey: #494848;
            --switch-bg: #f0f0f0;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
            background: var(--bg); color: var(--grey);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            position: fixed; 
            touch-action: none;
            -webkit-text-size-adjust: 100%;
        }

        .app { 
            display: flex; flex-direction: column; width: 100%; max-width: 500px; 
            height: 100dvh; margin: 0 auto;
            padding: env(safe-area-inset-top) 15px env(safe-area-inset-bottom);
        }

        header.header-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 5px 5px 0px; flex-shrink: 0; height: 45px;
        }

        .header-side { flex: 1; display: flex; align-items: center; }
        .header-side.right { justify-content: flex-end; }

        header h1 { 
            flex: 2; margin: 0; font-size: clamp(1.1rem, 5vw, 1.4rem); 
            font-weight: 900; text-align: center; color: var(--mid-grey);
            white-space: nowrap; letter-spacing: -0.5px;
        }

        .lang-switch-pill {
            width: 58px; height: 28px; background: var(--switch-bg);
            border-radius: 14px; position: relative; display: flex;
            align-items: center; cursor: pointer; padding: 2px;
            border: 1px solid #e5e5e5; user-select: none;
        }

        .lang-switch-pill span {
            flex: 1; font-size: 0.65rem; font-weight: 800; z-index: 2;
            color: #aaa; transition: color 0.3s; text-align: center;
        }

        .pill-thumb {
            position: absolute; width: 28px; height: 22px;
            background: #fff; border-radius: 12px; left: 2px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 1;
        }

        .app.lang-zh .pill-thumb { transform: translateX(24px); }
        .app.lang-zh #label-zh { color: var(--mid-grey); }
        .app.lang-en #label-en { color: var(--mid-grey); }

        #quote { 
            font-size: 0.85rem; color: #747373; margin-top: 0px;
            font-weight: 600; line-height: 1.2; min-height: 2.5em;
            display: flex; align-items: center; justify-content: center;
            text-align: center; padding: 0 10px; flex-shrink: 0;
        }

        main {
            flex: 1; display: flex; align-items: center; justify-content: center;
            position: relative; width: 100%; min-height: 0;
        }

        .window {
            position: relative; height: 95%; max-height: 420px;
            aspect-ratio: 2 / 3; background: #fff;
            border-radius: 15px; border: 1px solid #eee;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden;
        }

        #photo { position: absolute; inset: 0; background-size: cover; background-position: center; z-index: 1; }
        .success-zoom { transform: scale(1.1) !important; transition: transform 1s ease; }

        #canvas { 
            position: absolute; inset: 0; z-index: 50; 
            cursor: crosshair; touch-action: none; 
            opacity: 0; pointer-events: none;
        }
        #canvas.active { opacity: 1; pointer-events: auto; }

        #overlay {
            position: absolute; inset: 0; z-index: 100;
            background: rgba(255, 255, 255, 0.98);
            display: flex; align-items: center; justify-content: center;
            perspective: 1000px; transition: opacity 0.4s ease;
        }

        .card { width: 160px; height: 240px; position: relative; transform-style: preserve-3d; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
        .card.flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 12px; border: 1.5px solid var(--mid-grey); display: flex; align-items: center; justify-content: center; }
        .card-back { background: var(--mid-grey); color: #fff; font-weight: bold; letter-spacing: 2px; font-size: 0.9rem; }
        .card-front { background: #fff; color: var(--mid-grey); transform: rotateY(180deg); font-weight: 700; text-transform: uppercase; font-size: 0.9rem; }

        .sparkle-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 10; overflow: hidden; }
        .sparkle-overlay::after {
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg); animation: shine-sweep 3s ease-in-out infinite;
        }
        @keyframes shine-sweep { 0% { transform: translate(-100%, -100%) rotate(30deg); } 100% { transform: translate(100%, 100%) rotate(30deg); } }

        footer { flex: 0 0 auto; display: flex; flex-direction: column; align-items: center; padding: 10px 0 15px; }
        .btn-group { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 10px; min-height: 110px; }
        .btn-base { width: 80%; max-width: 220px; height: 48px; border-radius: 50px; font-weight: 800; font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; border: none; }
        .btn-primary { background: var(--mid-grey); color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .btn-secondary { background: #fff; color: var(--mid-grey); border: 2px solid var(--mid-grey); }
        .hidden-all { opacity: 0 !important; pointer-events: none !important; }
        @keyframes breathing-float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); background-color: #555; } }
        .btn-active-float { animation: breathing-float 2s ease-in-out infinite; }

        .copyright { margin-top: 10px; font-size: 0.55rem; color: #bbb; text-align: center; line-height: 1.4; padding: 0 20px; }
        .footer-link { color: #aaa; text-decoration: underline; }

        @media (max-height: 600px) {
            header.header-row { height: 40px; }
            header h1 { font-size: 1rem; }
            .window { max-height: 280px; }
        }
    </style>
</head>
<body class="lang-zh">

<div class="app" id="app-container">
    <header class="header-row">
        <div class="header-side"></div>
        <h1 id="title-main">Your Daily CORTIS!</h1>
        <div class="header-side right">
            <div class="lang-switch-pill" onclick="toggleLanguage()">
                <span id="label-en">EN</span>
                <span id="label-zh">ä¸­</span>
                <div class="pill-thumb"></div>
            </div>
        </div>
    </header>
    
    <div id="quote"></div>

    <main>
        <div class="window" id="card-window">
            <div id="photo"></div>
            <canvas id="canvas"></canvas>
            <div id="overlay">
                <div id="card-obj" class="card">
                    <div class="card-face card-back">CORTIS</div>
                    <div id="card-name" class="card-face card-front">?</div>
                </div>
            </div>
        </div>
    </main>

    <footer id="ui-footer">
        <div class="btn-group" id="btn-group">
            <button id="main-btn" class="btn-base btn-primary" onclick="handleMain()">æŠ½å–å°å¡</button>
            <button id="redraw-btn" class="btn-base btn-secondary" style="display: none;" onclick="handleRedraw()">é‡æ–°æŠ½å–</button>
        </div>
        <div id="copy-text" class="copyright"></div>
    </footer>
</div>

<script>
    const i18n = {
        zh: {
            title: "Your Daily CORTIS!",
            pullBtn: "æŠ½å–å°å¡", breakBtn: "æ­é–‹çœŸé¢ç›®", redrawBtn: "ä¸æ˜¯æœ¬å‘½ï¼Ÿå†æŠ½ä¸€æ¬¡",
            pullAgain: "å†æŠ½ä¸€æ¬¡", shuffling: "é‡æ–°æ´—ç‰Œä¸­...",
            pullMsgs: [
                "OMG! æ˜¯ {name}ï¼",
                "æº–å‚™å¥½äº†å—ï¼Ÿ{name} æ­£åœ¨ç­‰ä½ ã€‚",
                "ä»Šå¤©çš„å¹¸é‹æ˜Ÿæ˜¯ {name}ï¼",
                "é€™çµ•å°æ˜¯å‘½å®šçš„ä¸€æŠ½ï¼šæ˜¯ {name}ï¼",
                "{name} å·²å°±ç·’ï¼Œæ­£ç­‰å¾…èˆ‡ä½ ç›¸é‡ âœ¨",
                "æ‰“ç ´æ¡†æ¶ï¼Œçœ‹è¦‹æœ€çœŸå¯¦çš„ {name}ã€‚",
                "å¿«çœ‹ï¼{name} æ­£èº²åœ¨è¿·éœ§å¾Œå°ä½ å¾®ç¬‘ã€‚",
                "å™“... {name} çš„ç§˜å¯†é©šå–œå³å°‡æ­æ›‰ã€‚",
                "è½åˆ°äº†å—ï¼Ÿæ˜¯ä¾†è‡ª {name} çš„å¬å–š ğŸ’–",
                "å¿ƒè·³åŠ é€Ÿ... éš±ç´„çœ‹è¦‹ {name} çš„èº«å½±äº†ï¼",
                "å…¨ä¸–ç•Œæœ€æ£’çš„ {name} å³å°‡é™è‡¨ï¼",
                "æ„Ÿè¦ºåˆ°äº†å—ï¼Ÿé€™å¼µ {name} æ­£åœ¨æ•£ç™¼å…‰èŠ’ã€‚",
                "æŒ‡å°–çš„æº«åº¦ï¼Œå³å°‡å–šé†’æ²‰ç¡çš„ {name}ã€‚",
                "æº–å‚™å¥½è¿æ¥é©šå–œäº†å—ï¼Ÿæ˜¯è¶…ç´šé©šå–œçš„ {name}ï¼",
                "é€™æ˜¯å°ˆå±¬æ–¼ä½ èˆ‡ {name} çš„äº’å‹•æ™‚åˆ» ğŸ¬"
            ],
            successMsgs: [
                "âœ¨ æ•æ‰åˆ°æœ€é–ƒè€€çš„ {name} äº†ï¼",
                "ğŸ’– é€™æ˜¯å±¬æ–¼ä½ çš„é™å®š {name}ï¼",
                "ğŸŒŸ å®Œç¾çš„ç¬é–“ï¼{name} æ­£åœ¨ç™¼å…‰",
                "ğŸ¬ æ”¶è—æˆåŠŸï¼{name} å·²å…¥åº«",
                "ğŸ’ ä½ æŠ½åˆ°äº†é€™å¼µå‚³èªªç´šçš„ {name}ï¼",
                "ğŸ¦„ å¤¢å¹»è¯å‹•ï¼{name} ä¾†åˆ°ä½ èº«é‚Šäº†",
                "ğŸŒˆ é‹æ°£çˆ†æ£šï¼ç«Ÿç„¶é‡åˆ°äº†é€™å¼µ {name}",
                "ğŸ“¸ å¿«æˆªåœ–ï¼é€™å¼µ {name} çš„çœ¼ç¥å¤ªçŠ¯è¦äº†",
                "ğŸ”¥ å…¨å ´ç„¦é»ï¼{name} çš„æ°£å ´çœŸçš„å¾ˆå¼·",
                "ğŸ§¸ æ­å–œè§£é–ï¼æŠŠé€™ä»½æœ€ç‰¹åˆ¥çš„ {name} å¸¶èµ°å§",
                "ğŸ¨ å……æ»¿æ°›åœæ„Ÿçš„é€™ä¸€å¼µï¼Œå±•ç¾äº† {name} ç¨ç‰¹çš„é­…åŠ›",
                "âš¡ï¸ æš´æ“Šå¿ƒå‹•ï¼è¢« {name} çš„ç¾è²Œæ“Šä¸­äº†å—ï¼Ÿ",
                "ğŸ•Šï¸ æ²»ç™’ç³»ç¥é¡ï¼Œè®“ {name} é™ªä½ åº¦éä»Šå¤©",
                "âœ¨ æ¯ä¸€åƒç´ éƒ½æ˜¯é©šå–œï¼Œé€™å¼µ {name} çœŸçš„å¤ªå€¼å¾—æ”¶è—äº†",
                "ğŸ¥° åªè¦çœ‹åˆ° {name}ï¼Œæ„Ÿè¦ºæ•´å€‹äººéƒ½è¢«é»äº®äº†ï¼"
            ],
            copyright: "æœ¬ç¶²é ç‚º CORTIS æ‡‰æ´å°ä½œå“ï¼Œéå®˜æ–¹ç™¼è¡Œã€‚æ‰€æœ‰å½±åƒè³‡æºä¹‹ç‰ˆæ¬Šå‡å±¬åŸç¶“ç´€å…¬å¸åŠç‰ˆæ¬Šæ–¹æ‰€æœ‰ã€‚æœ¬ç¶²é åƒ…ä¾›å¨›æ¨‚èˆ‡æŠ€è¡“äº¤æµä½¿ç”¨ï¼Œåš´ç¦ä»»ä½•å•†æ¥­è¡Œç‚ºã€‚<br>Â© 2026 Your Daily CORTIS! by <a href='https://www.threads.net/@leeami0720' target='_blank' class='footer-link'>@leeami0720</a>"  
        },
        en: {
            title: "Your Daily CORTIS!",
            pullBtn: "Pull Card", breakBtn: "Check the look!", redrawBtn: "Not your bias? Re-pull",
            pullAgain: "Pull Again", shuffling: "Shuffling...",
            pullMsgs: [
                "OMG! It's {name}!",
                "Ready? {name} is waiting for you.",
                "{name} is your lucky star today!",
                "It's destiny: you've pulled {name}!",
                "{name} is ready and waiting to meet you âœ¨",
                "Break the lines to see the real {name}.",
                "Look! {name} is smiling behind the mist.",
                "Shh... {name}'s secret surprise is about to reveal.",
                "Can you hear it? It's a call from {name} ğŸ’–",
                "Heart racing... I can see {name}'s silhouette!",
                "The world's best {name} is arriving!",
                "Can you feel it? This {name} card is glowing.",
                "Your touch is about to wake up the sleeping {name}.",
                "Ready for a surprise? It's the amazing {name}!",
                "A special moment just for you and {name} ğŸ¬"
            ],
            successMsgs: [
                "âœ¨ Caught the shining {name}!",
                "ğŸ’– Your limited edition {name} is here!",
                "ğŸŒŸ Perfect! {name} is glowing!",
                "ğŸ¬ Captured! {name} added to collection.",
                "ğŸ’ You pulled a Legendary {name}!",
                "ğŸ¦„ Dreamy encounter! {name} is right by your side.",
                "ğŸŒˆ Peak luck! You've found the one and only {name}!",
                "ğŸ“¸ Screenshot time! {name}'s gaze is just too much.",
                "ğŸ”¥ Spotlight on! {name}'s presence is unmatched.",
                "ğŸ§¸ Unlocked! Take this special {name} with you.",
                "ğŸ¨ So much vibe! Showing {name}'s unique charm.",
                "âš¡ï¸ Heart-strike! Stunned by {name}'s visuals?",
                "ğŸ•Šï¸ Healing vibes! Let {name} brighten your day.",
                "âœ¨ Every pixel is a masterpiece! {name} is a must-have.",
                "ğŸ¥° Just seeing {name} makes everything better!"
            ],
            copyright: "This is a non-official fan-made project for entertainment only. <br>All images belong to their respective agencies. No commercial use intended.<br>Â© 2026 Your Daily CORTIS! by <a href='https://www.threads.net/leeami0720' target='_blank' class='footer-link'>@leeami0720</a>"
        }
    };

    let currentLang = localStorage.getItem('cortis_lang') || 'zh';
    let state = 'IDLE';
    let selectedMember = null;
    let selectedImg = null;
    let progressTimer = null;

    let currentPullMsgIdx = 0;
    let currentSuccessMsgIdx = 0;

    const members = [
        { 
            name: 'MARTIN', 
            imgs: [
                'https://i.meee.com.tw/MOYXYYH.jpg', //01
                'https://i.meee.com.tw/SEXIiU3.jpg', //02
                'https://i.meee.com.tw/zFRjemR.jpg', //03
                'https://i.meee.com.tw/nybbReK.jpg', //04
                'https://i.meee.com.tw/BFcRZlJ.jpg', //05
                'https://i.meee.com.tw/Pc2u4J8.jpg', //06
                'https://i.meee.com.tw/RnUITpD.jpg', //07
                'https://i.meee.com.tw/Zb8FRRs.jpg', //08
                'https://i.meee.com.tw/ZgqWbdW.jpg', //09
                'https://i.meee.com.tw/JPuCVMj.jpg', //10
                'https://i.meee.com.tw/cGxbgRL.jpg', //11
                'https://i.meee.com.tw/WZ9HKOt.jpg', //12
                'https://i.meee.com.tw/EAhkLPa.jpg', //13
                'https://i.meee.com.tw/CHRCiwv.jpg', //14
                'https://i.meee.com.tw/K4acoX3.jpg', //15
                'https://i.meee.com.tw/AgqCwUG.jpg', //16
                'https://i.meee.com.tw/IBiP9Xm.jpg', //17
                'https://i.meee.com.tw/0pdENOw.jpg', //18
                'https://i.meee.com.tw/wu2sbnG.jpg', //19
                'https://i.meee.com.tw/fPwFyVD.jpg', //20
                'https://i.meee.com.tw/VcFbdLs.jpg', //21
                'https://i.meee.com.tw/qCtj1y3.jpg', //22
                'https://i.meee.com.tw/IP97a5i.jpg', //23
                'https://i.meee.com.tw/0gKJbSE.jpg', //24
                'https://i.meee.com.tw/LHFUSDc.jpg', //25
                'https://i.meee.com.tw/9udlrZt.jpg', //26
                'https://i.meee.com.tw/63a3eGG.jpg', //27
                'https://i.meee.com.tw/QLI0KOO.jpg', //28
                'https://i.meee.com.tw/FBfCScg.jpg', //29
                'https://i.meee.com.tw/HKrjhy2.jpg', //30
                'https://i.meee.com.tw/nBHIUqX.jpg', //31
                'https://i.meee.com.tw/vGQkP0l.jpg', //32
                'https://i.meee.com.tw/npm2G9Y.jpg', //33
                'https://i.meee.com.tw/3pEHph6.jpg', //34
                'https://i.meee.com.tw/wbFC98x.jpg', //35
                'https://i.meee.com.tw/s7uRU3X.jpg', //36
                'https://i.meee.com.tw/GpmAtDL.jpg', //37
                'https://i.meee.com.tw/lb7RCBk.jpg', //38
                'https://i.meee.com.tw/BqGhZtG.jpg', //39
                'https://i.meee.com.tw/OiaypWz.jpg', //40
                'https://i.meee.com.tw/IBE84U7.jpg'  //41
            ] 
        },
        { 
            name: 'JAMES', 
            imgs: [
                'https://i.meee.com.tw/CVBsBfd.jpg', //01
                'https://i.meee.com.tw/xtAhmPX.jpg', //02
                'https://i.meee.com.tw/3G5NxcV.jpg', //03
                'https://i.meee.com.tw/kA8DG3b.jpg', //04
                'https://i.meee.com.tw/VMDbJX7.jpg', //05
                'https://i.meee.com.tw/agwNTow.jpg', //06
                'https://i.meee.com.tw/Ipfv0L5.jpg', //08
                'https://i.meee.com.tw/08xbMYK.jpg', //09
                'https://i.meee.com.tw/BMFBEF9.jpg', //10
                'https://i.meee.com.tw/443BjvM.jpg', //11
                'https://i.meee.com.tw/NyCrZFY.jpg', //12
                'https://i.meee.com.tw/nqHzylv.jpg', //13
                'https://i.meee.com.tw/HdAbga0.jpg', //14
                'https://i.meee.com.tw/tQ3LFv8.jpg', //15
                'https://i.meee.com.tw/Pgf02by.jpg', //17
                'https://i.meee.com.tw/tUHP9eq.jpg', //18
                'https://i.meee.com.tw/cFAFXHL.jpg', //19
                'https://i.meee.com.tw/iw81cbd.jpg', //20
                'https://i.meee.com.tw/ovceTuk.jpg', //21
                'https://i.meee.com.tw/7wCu2Ne.jpg', //22
                'https://i.meee.com.tw/b9zN4u7.jpg', //23
                'https://i.meee.com.tw/GatiyNi.jpg', //24
                'https://i.meee.com.tw/09mgKIc.jpg', //25
                'https://i.meee.com.tw/OhvD8d6.jpg', //26
                'https://i.meee.com.tw/xmxsUOU.jpg', //27
                'https://i.meee.com.tw/I9kGYfx.jpg', //29
                'https://i.meee.com.tw/qOU6Jq5.jpg', //30
                'https://i.meee.com.tw/WA6Owsw.jpg', //31
                'https://i.meee.com.tw/i9oRArI.jpg', //32
                'https://i.meee.com.tw/jPwvfEK.jpg', //33
                'https://i.meee.com.tw/uWJs9sT.jpg', //34
                'https://i.meee.com.tw/N3DAwqP.jpg', //35
                'https://i.meee.com.tw/Ak8oEDk.jpg', //36
                'https://i.meee.com.tw/N3J3tmF.jpg', //37
                'https://i.meee.com.tw/Zni4ahH.jpg', //38
                'https://i.meee.com.tw/OzvQZvK.jpg', //39
                'https://i.meee.com.tw/oAhHC9H.jpg', //40
                'https://i.meee.com.tw/YPibdR6.jpg', //41
                'https://i.meee.com.tw/GGAf8Wh.jpg', //42
                'https://i.meee.com.tw/AaNm91y.jpg', //43
                'https://i.meee.com.tw/vnOtoNj.jpg'  //44
            ] 
        },
        { 
            name: 'JUHOON', 
            imgs: [
                'https://i.meee.com.tw/NcdYMX7.jpg', //01
                'https://i.meee.com.tw/J9lZu2w.jpg', //02
                'https://i.meee.com.tw/2urGipe.jpg', //03
                'https://i.meee.com.tw/Etfw5vh.jpg', //04
                'https://i.meee.com.tw/XPZy2Ax.jpg', //05
                'https://i.meee.com.tw/idAqO9Z.jpg', //06
                'https://i.meee.com.tw/jG1kN6o.jpg', //07
                'https://i.meee.com.tw/6k15xnq.jpg', //08
                'https://i.meee.com.tw/ZuWz8u9.jpg', //09
                'https://i.meee.com.tw/NiWzAif.jpg', //10
                'https://i.meee.com.tw/XfHBS3X.jpg', //11
                'https://i.meee.com.tw/QLDYDN5.jpg', //12
                'https://i.meee.com.tw/RdO84FD.jpg', //13
                'https://i.meee.com.tw/iYWyYIV.jpg', //14
                'https://i.meee.com.tw/LyHeJwT.jpg', //15
                'https://i.meee.com.tw/6Iu0lc0.jpg', //16
                'https://i.meee.com.tw/cOiAmF3.jpg', //17
                'https://i.meee.com.tw/CPNWL6a.jpg', //18
                'https://i.meee.com.tw/F8KcTfr.jpg', //19
                'https://i.meee.com.tw/thhW0yr.jpg', //20
                'https://i.meee.com.tw/V7Fw2Fx.jpg', //21
                'https://i.meee.com.tw/2RUrC2b.jpg', //22
                'https://i.meee.com.tw/RtZyWdr.jpg', //23
                'https://i.meee.com.tw/FpqvDsF.jpg', //24
                'https://i.meee.com.tw/rcvG6eh.jpg', //25
                'https://i.meee.com.tw/VkCgEja.jpg', //26
                'https://i.meee.com.tw/7xURHqc.jpg', //27
                'https://i.meee.com.tw/lGZ6xBQ.jpg', //28
                'https://i.meee.com.tw/kqPD6I4.jpg', //29
                'https://i.meee.com.tw/26CRqzz.jpg', //30
                'https://i.meee.com.tw/hrxaA4d.jpg', //31
                'https://i.meee.com.tw/GJcXP2N.jpg', //32
                'https://i.meee.com.tw/ZbPgm5R.jpg', //33
                'https://i.meee.com.tw/62oX3v0.jpg', //34
                'https://i.meee.com.tw/Mqfwqov.jpg', //35
                'https://i.meee.com.tw/T9M6c8T.jpg', //36
                'https://i.meee.com.tw/QTcLlEG.jpg', //37
                'https://i.meee.com.tw/L0hUH8u.jpg', //38
                'https://i.meee.com.tw/9qdsKFy.jpg', //39
                'https://i.meee.com.tw/1Dn8QUo.jpg', //40
                'https://i.meee.com.tw/PYgaVcq.jpg'  //41

            ] 
        },
        { 
            name: 'SEONGHYEON', 
            imgs: [
                'https://i.meee.com.tw/BIumaWw.jpg', //01
                'https://i.meee.com.tw/1EVXMKA.jpg', //02
                'https://i.meee.com.tw/ovZEBqB.jpg', //03
                'https://i.meee.com.tw/stTT15O.jpg', //04
                'https://i.meee.com.tw/4BkHrGv.jpg', //05
                'https://i.meee.com.tw/IttS1Qk.jpg', //06
                'https://i.meee.com.tw/zEEp4hj.jpg', //07
                'https://i.meee.com.tw/Wmvt06M.jpg', //08
                'https://i.meee.com.tw/HC1zIaI.jpg', //09
                'https://i.meee.com.tw/48UcC4j.jpg', //10
                'https://i.meee.com.tw/7bjuACv.jpg', //11
                'https://i.meee.com.tw/4SA8Zfn.jpg', //12
                'https://i.meee.com.tw/50ugDvH.jpg', //13
                'https://i.meee.com.tw/R3gWDCJ.jpg', //14
                'https://i.meee.com.tw/OxAENiY.jpg', //15
                'https://i.meee.com.tw/PncXEQb.jpg', //16
                'https://i.meee.com.tw/dFGOhkJ.jpg', //17
                'https://i.meee.com.tw/wJ0yrIp.jpg', //18
                'https://i.meee.com.tw/pvDLmWS.jpg', //19
                'https://i.meee.com.tw/cBpEnL7.jpg', //20
                'https://i.meee.com.tw/iGx6FU4.jpg', //21
                'https://i.meee.com.tw/uVaK1ZC.jpg', //22
                'https://i.meee.com.tw/Coe2Xji.jpg', //23
                'https://i.meee.com.tw/rmLojta.jpg', //24
                'https://i.meee.com.tw/fUyJ5uZ.jpg', //25
                'https://i.meee.com.tw/pTTflJj.jpg', //26
                'https://i.meee.com.tw/G9VS9NE.jpg', //27
                'https://i.meee.com.tw/7RTGCmf.jpg', //28
                'https://i.meee.com.tw/EgTENpf.jpg', //29
                'https://i.meee.com.tw/ocU7do0.jpg', //30
                'https://i.meee.com.tw/XdMepIA.jpg', //31
                'https://i.meee.com.tw/MMlSVTC.jpg', //32
                'https://i.meee.com.tw/4diqcVU.jpg', //33
                'https://i.meee.com.tw/LobjZF4.jpg', //34
                'https://i.meee.com.tw/E7m4FCB.jpg', //35
                'https://i.meee.com.tw/l9T7qtd.jpg', //36
                'https://i.meee.com.tw/DMGbGxW.jpg', //37
                'https://i.meee.com.tw/zzR5FSh.jpg', //38
                'https://i.meee.com.tw/bPUxjlO.jpg', //39
                'https://i.meee.com.tw/DDetHVG.jpg', //40
                'https://i.meee.com.tw/Lqddbrl.jpg'  //41
            ] 
        },
        { 
            name: 'KEONHO', 
            imgs: [
                'https://i.meee.com.tw/RifsdWi.jpg', //01
                'https://i.meee.com.tw/h6sBuPV.jpg', //02
                'https://i.meee.com.tw/orrhHJ9.jpg', //03
                'https://i.meee.com.tw/ulzgelY.jpg', //04
                'https://i.meee.com.tw/hrasay4.jpg', //05
                'https://i.meee.com.tw/KdBrKDx.jpg', //06
                'https://i.meee.com.tw/us2KGpy.jpg', //07
                'https://i.meee.com.tw/UwUBIUD.jpg', //08
                'https://i.meee.com.tw/gF9niFB.jpg', //09
                'https://i.meee.com.tw/CRHCpB1.jpg', //10
                'https://i.meee.com.tw/BdkFp7E.jpg', //11
                'https://i.meee.com.tw/EpSMghF.jpg', //12
                'https://i.meee.com.tw/IiOHTxO.jpg', //13
                'https://i.meee.com.tw/FKtO9gB.jpg', //14
                'https://i.meee.com.tw/uvavWIW.jpg', //15
                'https://i.meee.com.tw/ey4XbGj.jpg', //16
                'https://i.meee.com.tw/yFoEH6Y.jpg', //17
                'https://i.meee.com.tw/cyAyduB.jpg', //18
                'https://i.meee.com.tw/pzm48tI.jpg', //19
                'https://i.meee.com.tw/qGoDBGL.jpg', //20
                'https://i.meee.com.tw/OvezIXK.jpg', //21
                'https://i.meee.com.tw/lc2cvnR.jpg', //22
                'https://i.meee.com.tw/6EIUcNn.jpg', //23
                'https://i.meee.com.tw/EM9l1yO.jpg', //24
                'https://i.meee.com.tw/7cDaWyU.jpg', //25
                'https://i.meee.com.tw/VBOiyxl.jpg', //26
                'https://i.meee.com.tw/7RhEFsO.jpg', //27
                'https://i.meee.com.tw/gWFHTfh.jpg', //28
                'https://i.meee.com.tw/PMSu76m.jpg', //29
                'https://i.meee.com.tw/2TjeXdU.jpg', //30
                'https://i.meee.com.tw/edDiacb.jpg', //31
                'https://i.meee.com.tw/9Ss2EVA.jpg', //32
                'https://i.meee.com.tw/leGjRQu.jpg', //33
                'https://i.meee.com.tw/iRghcBx.jpg', //34
                'https://i.meee.com.tw/sIHEA1v.jpg', //35
                'https://i.meee.com.tw/Bo8qOPs.jpg', //36
                'https://i.meee.com.tw/f9DcHTT.jpg', //37
                'https://i.meee.com.tw/JIfMKy7.jpg', //38
                'https://i.meee.com.tw/i95UGif.jpg', //39
                'https://i.meee.com.tw/xkbTgyT.jpg', //40
                'https://i.meee.com.tw/24EydLu.jpg'  //41
            ] 
        }
    ];

    const canvas = document.getElementById('canvas'), ctx = canvas.getContext('2d', { willReadFrequently: true });
    const photo = document.getElementById('photo'), overlay = document.getElementById('overlay');
    const mainBtn = document.getElementById('main-btn'), redrawBtn = document.getElementById('redraw-btn');
    const quoteBox = document.getElementById('quote'), appCont = document.getElementById('app-container');

    function updateUI() {
        const lang = i18n[currentLang];
        document.getElementById('title-main').innerText = lang.title;
        document.getElementById('copy-text').innerHTML = lang.copyright;

        if (currentLang === 'zh') { appCont.classList.add('lang-zh'); appCont.classList.remove('lang-en'); } 
        else { appCont.classList.add('lang-en'); appCont.classList.remove('lang-zh'); }

        if (state === 'IDLE') {
            mainBtn.innerText = lang.pullBtn;
            mainBtn.classList.remove('btn-active-float');
            redrawBtn.style.display = 'none';
            quoteBox.innerText = "";
            canvas.classList.remove('active');
        } else if (state === 'DRAWN') {
            mainBtn.innerText = lang.breakBtn;
            mainBtn.classList.add('btn-active-float'); 
            redrawBtn.innerText = lang.redrawBtn;
            redrawBtn.style.display = 'flex';
            const msg = lang.pullMsgs[currentPullMsgIdx]; 
            quoteBox.innerText = msg.replace("{name}", selectedMember.name);
        } else if (state === 'END') {
            mainBtn.innerText = lang.pullAgain;
            mainBtn.classList.remove('btn-active-float');
            redrawBtn.style.display = 'none';
            const msg = lang.successMsgs[currentSuccessMsgIdx];
            quoteBox.innerText = msg.replace("{name}", selectedMember.name);
        }
    }

    function toggleLanguage() {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        localStorage.setItem('cortis_lang', currentLang); 
        updateUI();
    }

    function handleMain() {
        if (state === 'IDLE') pull();
        else if (state === 'DRAWN') startPlay();
        else if (state === 'END') resetGame();
    }

    function pull() {
        selectedMember = members[Math.floor(Math.random() * members.length)];
        selectedImg = selectedMember.imgs[Math.floor(Math.random() * selectedMember.imgs.length)];

        currentPullMsgIdx = Math.floor(Math.random() * i18n[currentLang].pullMsgs.length);

        document.getElementById('card-name').innerText = selectedMember.name;
        document.getElementById('card-obj').classList.add('flipped');
        
        initCanvas(); 
        
        state = 'DRAWN';
        updateUI();
    }

    function handleRedraw() {
        document.getElementById('card-obj').classList.remove('flipped');
        state = 'IDLE'; updateUI(); 
        quoteBox.innerText = i18n[currentLang].shuffling;
        setTimeout(pull, 400);
    }

    function resetGame() {
        state = 'IDLE';
        document.getElementById('card-obj').classList.remove('flipped');
        overlay.style.display = "flex"; overlay.style.opacity = "1";
        photo.classList.remove('success-zoom');
        const oldSparkle = document.querySelector('.sparkle-overlay');
        if (oldSparkle) oldSparkle.remove();
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        updateUI();
    }

    function initCanvas() {
        const rect = document.getElementById('card-window').getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        ctx.globalCompositeOperation = 'source-over';
        ctx.fillStyle = '#eeeeee';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = 25;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
    }

    function startPlay() {
        state = 'PLAYING';
        document.getElementById('btn-group').classList.add('hidden-all');
        
        photo.style.backgroundImage = `url('${selectedImg}')`;
        canvas.classList.add('active');
        
        overlay.style.opacity = "0";
        setTimeout(() => {
            overlay.style.display = "none";
        }, 400);
        
        progressTimer = setInterval(calcProgress, 500);
    }

    let isDrawing = false;
    let lastX = 0, lastY = 0;

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.clientX || (e.touches && e.touches[0].clientX);
        const clientY = e.clientY || (e.touches && e.touches[0].clientY);
        return { x: clientX - rect.left, y: clientY - rect.top };
    }

    canvas.addEventListener('pointerdown', (e) => {
        if (state !== 'PLAYING') return;
        isDrawing = true;
        const pos = getPos(e);
        lastX = pos.x; 
        lastY = pos.y;

        ctx.beginPath();
        ctx.arc(pos.x, pos.y, ctx.lineWidth / 2, 0, Math.PI * 2);
        ctx.fill();

    });

    window.addEventListener('pointermove', (e) => {
        if (!isDrawing || state !== 'PLAYING') return;
        const pos = getPos(e);
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastX = pos.x; lastY = pos.y;
    });

    window.addEventListener('pointerup', () => isDrawing = false);

    function calcProgress() {
        if (state !== 'PLAYING') return;
        const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let clear = 0;
        for (let i = 3; i < data.length; i += 120) { if (data[i] === 0) clear++; }
        if ((clear / (data.length / 120)) * 100 >= 85) endPlay();
    }

    function endPlay() {
        clearInterval(progressTimer);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        canvas.classList.remove('active');
        photo.classList.add('success-zoom');
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle-overlay';
        document.getElementById('card-window').appendChild(sparkle);
        currentSuccessMsgIdx = Math.floor(Math.random() * i18n[currentLang].successMsgs.length);
        state = 'END';
        document.getElementById('btn-group').classList.remove('hidden-all');
        updateUI();
    }

    document.addEventListener('gesturestart', function (e) {
        e.preventDefault();
    });

    document.addEventListener('touchstart', function (event) {
        if (event.touches.length > 1) {
            event.preventDefault();
        }
    }, { passive: false });

    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
        let now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
            event.preventDefault();
        }
        lastTouchEnd = now;
    }, false);
   
    window.onload = updateUI;
</script>
</body>
</html>